<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="require-config.js"></script>
    <script src="require.js"></script>
    <link rel="stylesheet" type="text/css" href="lib/qunit-1.14.0.css">
    <title>Sample</title>
</head>
<body>
<div id="qunit"></div>
<div id="qunit-fixture"></div>
<script type="application/javascript">
    require(['lib/domReady!',
        'jquery',
        'qunit',
        'q',
        'todo/jquery/createTodoApplication'], function (dom, $, qunit, Q, createTodoApplication) {
        'use strict';
        var createFakeJsonOverHttp = function (calls) {
            var callIndex;
            callIndex = 0;
            return function (options) {
                console.log('fake json');
                var deferredResponse;
                qunit.equal(options.uri, calls[callIndex].request.uri, 'uri matches for call ' + callIndex);
                qunit.equal(options.method, calls[callIndex].request.method, 'method matches for call ' + callIndex);
                qunit.deepEqual(options.body, calls[callIndex].request.body, 'body matches for call ' + callIndex);
                deferredResponse = Q.defer();
                deferredResponse.resolve(calls[callIndex].response);
                callIndex++;
                return deferredResponse.promise;
            };
        };
        qunit.asyncTest('start with no items', function () {
            var appPromise, jsonOverHttp;
            jsonOverHttp = createFakeJsonOverHttp([
                {
                    request: {uri: 'item', method: 'GET'},
                    response: { status: 200, body: []}
                }
            ]);
            appPromise = createTodoApplication(jsonOverHttp);
            appPromise.then(function (app) {
                console.log('got app');
                qunit.equal(app.dom.find('li').length, 0, 'no items');
                qunit.start();
            });
        });
//        qunit.test('add item', function () {
//            var app, jsonOverHttp, appDelegate;
//            jsonOverHttp = createFakeJsonOverHttp([
//                {
//                    request: {uri: 'item', method: 'GET'},
//                    response: { status: 200, body: []}
//                },
//                {
//                    request: {uri: 'item', method: 'POST', body: {}},
//                    response: { status: 200, body: []}
//                }
//            ]);
//            app = createTodoApplication(jsonOverHttp);
//            appDelegate = app.pressAddButton();
//            appDelegate.then(function(){
//                qunit.equal(app.dom.find('li').length, 1, 'one item added');
//                qunit.equal($(app.dom.find('li')[0]).text(), 'item 1', 'item 1');
//            });
//        });
//        qunit.test('add many items', function () {
//            var $el, addButton;
//            $el = createTodoApplication();
//            addButton = $el.find('.add');
//            addButton.click();
//            addButton.click();
//            addButton.click();
//            qunit.equal($el.find('li').length, 3, 'three items added');
//            qunit.equal($($el.find('li')[0]).text(), 'item 1', 'item 1');
//            qunit.equal($($el.find('li')[1]).text(), 'item 2', 'item 2');
//            qunit.equal($($el.find('li')[2]).text(), 'item 3', 'item 3');
//        });
        qunit.load();
        qunit.start();
    });
</script>
</body>
</html>
